<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Debug CSV Processor</title>
</head>
<body>
  <h1>Debug CSV Processor</h1>
  <input type="file" id="csvFile" accept=".csv">
  <div id="output"></div>
  
  <script>
    document.getElementById('csvFile').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      
      const reader = new FileReader();
      reader.onload = function(e) {
        const csv = e.target.result;
        console.log('CSV loaded, length:', csv.length);
        
        // Procesar CSV
        const lines = csv.split('\n');
        const headers = lines[0].split(',');
        console.log('Headers found:', headers);
        
        // Buscar las columnas requeridas
        const requiredColumns = [
          'Requisition #', 'Status', 'Net total', 'Originated by',
          'Date of last approval', 'Sent for approval date',
          'Last approver of the document', 'Last approver to date',
          'Requisition #(Corcentric ID)'
        ];
        
        const columnIndices = requiredColumns.map(col => {
          const index = headers.findIndex(header => header.trim() === col);
          console.log(`Column "${col}" found at index:`, index);
          return index;
        });
        
        console.log('Column indices:', columnIndices);
        
        // Filtrar datos
        const filteredData = [];
        for (let i = 1; i < lines.length; i++) {
          const row = lines[i].split(',');
          const status = row[4]; // Status column
          
          if (status && (status.includes('More information needed') || status.includes('To be approved'))) {
            const filteredRow = columnIndices.map(index => row[index] || '');
            filteredData.push(filteredRow);
            console.log('Filtered row:', filteredRow);
          }
        }
        
        console.log('Total filtered rows:', filteredData.length);
        
        // Mostrar resultado
        const output = document.getElementById('output');
        output.innerHTML = `
          <h2>Resultado del procesamiento:</h2>
          <p>Total headers: ${headers.length}</p>
          <p>Total rows: ${lines.length - 1}</p>
          <p>Filtered rows: ${filteredData.length}</p>
          <p>Column indices: ${columnIndices.join(', ')}</p>
          <h3>Headers encontrados:</h3>
          <pre>${JSON.stringify(headers, null, 2)}</pre>
          <h3>Primeras 5 filas filtradas:</h3>
          <pre>${JSON.stringify(filteredData.slice(0, 5), null, 2)}</pre>
        `;
      };
      
      reader.readAsText(file);
    });
  </script>
</body>
</html>
